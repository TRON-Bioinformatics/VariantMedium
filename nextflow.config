/*
 * -------------------------------------------------
 *  TRON-Bioinformatics/variantmedium
 * -------------------------------------------------
 */
params {
  
  // cmdline options
  samplesheet            = null  // path to samplesheet
  outdir                 = null  // path to generate pipeline outputs
  execution_step         = null  // execution step: [prepare_tsv_inputs, stage_data, candidate_filtering, call_variants]
  mount_path             = null  // path to bind mount when using singularity profile
  snv_calling            = true  // whether to call SNVs
  indel_calling          = false // whether to call Indels
  run_data_staging       = true  // whether to stage input data files
  skip_preprocessing     = false // whether to skip preprocessing step

  // data publishing
  prepare_tsv_outs          = 'tsv_folder'
  data_staging_outs         = 'data_staging'
  preprocess_outs           = 'output_01_01_preprocessed_bams'
  candidate_calling_outs    = 'output_01_02_candidate_calls'
  vcf_postprocessing_outs   = 'output_01_03_vcf_postprocessing'
  candidate_filtering_outs  = 'output_01_04_candidates_extratrees'
  bam2tensor_outs           = 'output_01_05_tensors'
  variant_calling_outs      = 'output_01_06_calls_densenet'
  publish_dir_mode          = 'copy'


  // process specific
  bed_url                = "http://hgdownload.soe.ucsc.edu/gbdb/hg38/exomeProbesets/S07604624_Covered.bb" // URL to exome target regions in bigBed format
  reference_dir          = 'ref_data'   // directory name for reference data
  models_dir             = 'models'     // directory name for trained models


  // variantmedium call
  learning_rate = 0.13
  drop_rate = 0.3
  epoch = 0

  // version - needs an update with each release
  version = '1.1.0'

}

process {
  beforeScript = '''
    echo SLURM_JOB_ID=$SLURM_JOB_ID
  '''
}

profiles {
  conda {
    conda.enabled          = true
  }
  singularity {
    singularity.enabled    = true
    singularity.autoMounts = true
    singularity.runOptions = "--bind ${params.mount_path}"
  }
  slurm {
    process {
      executor = 'slurm'  
    }
  }
}

// Capture exit codes from upstream processes when piping
process.shell = ['/bin/bash', '-euo', 'pipefail']

manifest {
  name = 'TRON-Bioinformatics/variantmedium'
  author = 'Ozlem Muslu, Jonas Ibn-Salem, Shaya Akbarinejad, Luis Kress, Sameesh Kher'
  homePage = 'https://github.com/TRON-Bioinformatics/variantmedium'
  description = 'Somatic point mutation calling using 3D DenseNets'
  mainScript = 'main.nf'
  nextflowVersion = '>=24.10.3'
  version = "${params.version}"
  doi = 'doi'
}

cleanup=true

// Load base.config & modules.config for DSL2 module specific options
includeConfig 'conf/base.config'
includeConfig 'conf/modules.config'
